<!doctype html>
<html>
  <head>
    <title>Patient Details</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: #f4f6f9;
      }
      .card {
        border-radius: 12px;
      }
      .label {
        font-weight: 600;
        color: #555;
      }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <button class="btn btn-secondary mb-3" onclick="goBack()">← Back</button>

      <div class="card shadow p-4">
        <h3 class="mb-4">Patient Full Details</h3>

        <div id="patientData"></div>
      </div>
    </div>

    <script>
      const API = "https://nmk-system.onrender.com";
      const token = localStorage.getItem("token");

      const params = new URLSearchParams(window.location.search);
      const patientId = params.get("id");

      if (!token) {
        window.location.href = "index.html";
      }

      async function loadPatientDetails() {
        const response = await fetch(API + "/patients/" + patientId, {
          headers: {
            Authorization: "Bearer " + token,
          },
        });

        const data = await response.json();

        if (!response.ok) {
          alert("Patient not found");
          window.location.href = "patients.html";
          return;
        }
        document.getElementById("patientData").innerHTML = `
            <div class="row mb-3">
                <div class="col-md-4"><strong>ID:</strong> ${data.ID ?? "-"}</div>
                <div class="col-md-4"><strong>Name:</strong> ${data.Name ?? "-"}</div>
                <div class="col-md-4"><strong>Guardian:</strong> ${data.Guardian ?? "-"}</div>
            </div>

            <div class="row mb-3">
              <div class="col-md-4"><strong>Mobile:</strong> ${data.Mobile ?? "-"}</div>
                <div class="col-md-4">
                    <strong>Admission Date:</strong> ${data.AdmissionDate ?? "-"}<br>
                    <strong>Duration:</strong> ${data.Months ?? 0} Months, ${data.Days ?? 0} Days
                </div>
              <div class="col-md-4"><strong>Addiction Type:</strong> ${data.AddictionType ?? "-"}</div>
            </div>

            <div class="row mb-3">
                <div class="col-md-4"><strong>Total Fees:</strong> ₹${data.TotalFees ?? 0}</div>
                <div class="col-md-4"><strong>Paid Amount:</strong> ₹${data.PaidAmount ?? 0}</div>
                <div class="col-md-4"><strong>Balance:</strong> ₹${data.Balance ?? 0}</div>
            </div>

            <div class="row mb-3">
                <div class="col-md-4"><strong>Pickup Type:</strong> ${data.PickupType ?? "-"}</div>
                <div class="col-md-4"><strong>Distance (KM):</strong> ${data.DistanceKM ?? "-"}</div>
                <div class="col-md-4"><strong>Status:</strong> ${data.Status ?? "-"}</div>
            </div>
            `;
      }

      function goBack() {
        window.location.href = "patients.html";
      }

      loadPatientDetails();
    </script>
  </body>
</html>
