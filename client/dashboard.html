<!DOCTYPE html>
<html>
<head>
  <title>NMK Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      overflow-x: hidden;
    }
    .sidebar {
      height: 100vh;
      background: #1e293b;
      color: white;
      position: fixed;
      width: 220px;
      padding-top: 20px;
    }
    .sidebar a {
      color: white;
      text-decoration: none;
      display: block;
      padding: 10px 20px;
    }
    .sidebar a:hover {
      background: #334155;
    }
    .sidebar a.active {
      background: #0f172a;
      font-weight: bold;
    }
    
    .content {
      margin-left: 220px;
      padding: 20px;
    }
    .summary-card {
      border-radius: 10px;
      color: white;
    }

    .card-patients { background: #3b82f6; }
    .card-collection { background: #10b981; }
    .card-pending { background: #ef4444; }
    .card-today { background: #f59e0b; }

    .summary-card h6 {
      font-size: 14px;
      opacity: 0.9;
    }

    .summary-card h4 {
      font-size: 22px;
      font-weight: bold;
    }
    .card {
  border-radius: 12px;
}

.card h6 {
  opacity: 0.8;
  margin-bottom: 5px;
}

.card h4 {
  font-weight: 600;
}

.table {
  border-radius: 10px;
  overflow: hidden;
}

.table thead th {
  padding: 12px;
}

.table td {
  padding: 12px;
}
.table-striped > tbody > tr:nth-of-type(odd) > * {
  background-color: #e2e8f0 !important;
}
.table tbody tr:hover {
  background-color: #cbd5e1 !important;
  transition: 0.2s;
}
.sidebar a {
  transition: 0.2s;
}
.btn-primary {
  border-radius: 8px;
  font-weight: 500;
}
.content {
  animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

    
  </style>
</head>
<body class="bg-light">

<div class="sidebar">
  <h4 class="text-center mb-4">NMK Admin</h4>
  <a href="dashboard.html" class="active">Dashboard</a>
  <a href="patients.html">Patients</a>
  <a href="payments.html">Payments</a>
  <a href="#" onclick="logout()">Logout</a>
</div>


<div class="content">
  <h2>Dashboard</h2>

  <div id="summaryCards" class="row mb-4"></div>

  <div class="card p-3 shadow">
    <h5>Recent Payments</h5>
    <div id="recentPayments"></div>
  </div>
</div>

<script>
const token = localStorage.getItem("token");

if (!token) {
  window.location.href = "index.html";
}

async function loadDashboard() {

  const dashboardRes = await fetch("https://nmk-system.onrender.com/dashboard", {
    headers: { "Authorization": "Bearer " + token }
  });

  const dashboardData = await dashboardRes.json();

  const paymentsRes = await fetch("https://nmk-system.onrender.com/payments", {
    headers: { "Authorization": "Bearer " + token }
  });

  const paymentsData = await paymentsRes.json();

  const today = new Date().toISOString().split("T")[0];
  let todayCollection = 0;

  paymentsData.payments.forEach(p => {
    if (p.PaymentDate === today) {
      todayCollection += Number(p.Amount);
    }
  });

  document.getElementById("summaryCards").innerHTML = `
  <div class="col-md-3">
    <div class="card p-3 shadow summary-card card-patients">
      <h6>Total Patients</h6>
      <h4>${dashboardData.totalPatients}</h4>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card p-3 shadow summary-card card-collection">
      <h6>Total Collection</h6>
      <h4>₹${dashboardData.totalCollection}</h4>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card p-3 shadow summary-card card-pending">
      <h6>Total Pending</h6>
      <h4>₹${dashboardData.totalPending}</h4>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card p-3 shadow summary-card card-today">
      <h6>Today's Collection</h6>
      <h4>₹${todayCollection}</h4>
    </div>
  </div>
`;


  const recent = paymentsData.payments.slice(-5).reverse();

  let table = `
    <table class="table table-bordered table-striped align-middle">
      <thead class="table-dark">
        <tr>
          <th>Payment ID</th>
          <th>Patient</th>
          <th>Amount</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
  `;

  recent.forEach(p => {
    table += `
      <tr>
        <td>${p.PaymentID}</td>
        <td>${p.PatientID}</td>
        <td>₹${p.Amount}</td>
        <td>${formatDate(p.PaymentDate)}</td>
      </tr>
    `;
  });

  table += `</tbody></table>`;

  document.getElementById("recentPayments").innerHTML = table;
}
function formatDate(dateString) {
  const date = new Date(dateString);
  const day = String(date.getDate()).padStart(2, '0');
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const year = date.getFullYear();
  return `${day}/${month}/${year}`;
}


function logout() {
  localStorage.removeItem("token");
  window.location.href = "index.html";
}

loadDashboard();
</script>

</body>
</html>
